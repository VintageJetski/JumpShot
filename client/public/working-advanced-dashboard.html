<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS2 Analytics Platform - Advanced Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f8fafc;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: #94a3b8;
            margin-top: 4px;
        }

        .nav {
            display: flex;
            gap: 12px;
        }

        .nav button {
            padding: 10px 20px;
            border: none;
            background: rgba(59, 130, 246, 0.1);
            color: #93c5fd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav button:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateY(-2px);
        }

        .nav button.active {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 400px;
            font-size: 18px;
            color: #94a3b8;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .grid {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); }
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }

        .card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 12px;
            padding: 24px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .card h2, .card h3 {
            margin-bottom: 16px;
            color: #f1f5f9;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 14px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #f1f5f9;
        }

        .player-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(51, 65, 85, 0.5);
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .player-item:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: translateX(4px);
        }

        .player-name {
            font-weight: 600;
            color: #f1f5f9;
        }

        .player-team {
            color: #94a3b8;
            font-size: 14px;
        }

        .piv-score {
            font-weight: 700;
            color: #3b82f6;
            font-size: 16px;
        }

        .role-badge {
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .filter-bar {
            display: flex;
            gap: 20px;
            margin-bottom: 24px;
            padding: 20px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 12px;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-group label {
            color: #94a3b8;
            font-size: 14px;
            font-weight: 500;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            background: rgba(51, 65, 85, 0.8);
            color: #f1f5f9;
            border-radius: 6px;
            outline: none;
        }

        .vs-indicator {
            font-size: 24px;
            font-weight: 700;
            color: #3b82f6;
            margin: 0 20px;
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
            }

            .nav {
                flex-wrap: wrap;
                justify-content: center;
            }

            .filter-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .vs-indicator {
                margin: 10px 0;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <div class="title">CS2 Analytics Platform</div>
                <div class="subtitle">Advanced Tournament Analysis - IEM Katowice 2025</div>
            </div>
            <div class="nav">
                <button onclick="showView('dashboard')" class="active" id="btn-dashboard">Dashboard</button>
                <button onclick="showView('players')" id="btn-players">Players</button>
                <button onclick="showView('teams')" id="btn-teams">Teams</button>
                <button onclick="showView('analytics')" id="btn-analytics">Analytics</button>
                <button onclick="showView('comparison')" id="btn-comparison">Compare</button>
                <button onclick="showView('prediction')" id="btn-prediction">Predictions</button>
            </div>
        </div>
        
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div>Loading Advanced CS2 Analytics...</div>
        </div>

        <!-- Dashboard View -->
        <div id="dashboard-view" class="hidden">
            <div class="grid grid-4" id="stats-overview"></div>
            <div class="grid grid-2">
                <div class="card">
                    <h2>Top Players by PIV</h2>
                    <div id="top-players-dashboard" class="player-list"></div>
                </div>
                <div class="card">
                    <h2>Top Teams by TIR</h2>
                    <div id="top-teams-dashboard" class="player-list"></div>
                </div>
            </div>
        </div>

        <!-- Players View -->
        <div id="players-view" class="hidden">
            <div class="filter-bar">
                <div class="filter-group">
                    <label>Team:</label>
                    <select id="team-filter">
                        <option value="">All Teams</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Role:</label>
                    <select id="role-filter">
                        <option value="">All Roles</option>
                        <option value="AWPer">AWPer</option>
                        <option value="Entry Fragger">Entry Fragger</option>
                        <option value="Support">Support</option>
                        <option value="Lurker">Lurker</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Sort by:</label>
                    <select id="sort-filter">
                        <option value="piv">PIV Score</option>
                        <option value="kd">K/D Ratio</option>
                        <option value="name">Name</option>
                    </select>
                </div>
            </div>
            <div class="grid grid-3" id="players-grid"></div>
        </div>

        <!-- Teams View -->
        <div id="teams-view" class="hidden">
            <div class="grid grid-2" id="teams-grid"></div>
        </div>

        <!-- Analytics View -->
        <div id="analytics-view" class="hidden">
            <div class="grid grid-3">
                <div class="card">
                    <h2>Statistical Insights</h2>
                    <div id="insights-panel"></div>
                </div>
                <div class="card">
                    <h2>Advanced Metrics</h2>
                    <div id="advanced-metrics"></div>
                </div>
                <div class="card">
                    <h2>Performance Outliers</h2>
                    <div id="outliers-analysis"></div>
                </div>
            </div>
        </div>

        <!-- Comparison View -->
        <div id="comparison-view" class="hidden">
            <div class="filter-bar">
                <div class="filter-group">
                    <label>Player 1:</label>
                    <select id="player1-select"></select>
                </div>
                <div class="vs-indicator">VS</div>
                <div class="filter-group">
                    <label>Player 2:</label>
                    <select id="player2-select"></select>
                </div>
                <button onclick="comparePlayers()" style="padding: 8px 16px; background: #2563eb; color: white; border: none; border-radius: 4px;">Compare</button>
            </div>
            <div id="comparison-results" class="grid grid-2"></div>
        </div>

        <!-- Prediction View -->
        <div id="prediction-view" class="hidden">
            <div class="card">
                <h2>Match Prediction Engine</h2>
                <div class="filter-bar">
                    <div class="filter-group">
                        <label>Team A:</label>
                        <select id="teamA-select"></select>
                    </div>
                    <div class="vs-indicator">VS</div>
                    <div class="filter-group">
                        <label>Team B:</label>
                        <select id="teamB-select"></select>
                    </div>
                    <button onclick="predictMatch()" style="padding: 8px 16px; background: #059669; color: white; border: none; border-radius: 4px;">Predict</button>
                </div>
                <div id="prediction-results"></div>
            </div>
        </div>
    </div>

    <script>
        let playersData = [];
        let teamsData = [];

        function showView(viewName) {
            document.querySelectorAll('[id$="-view"]').forEach(view => {
                view.classList.add('hidden');
            });
            
            document.querySelectorAll('.nav button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const targetView = document.getElementById(viewName + '-view');
            if (targetView) {
                targetView.classList.remove('hidden');
            }
            
            const targetButton = document.getElementById('btn-' + viewName);
            if (targetButton) {
                targetButton.classList.add('active');
            }

            if (viewName === 'players') {
                filterAndDisplayPlayers();
            } else if (viewName === 'teams') {
                displayTeamsGrid();
            } else if (viewName === 'analytics') {
                displayAnalyticsView();
            }
        }

        function populateDashboard() {
            displayStatsOverview();
            displayTopPlayers();
            displayTopTeams();
            populateFilters();
        }

        function displayStatsOverview() {
            const totalPlayers = playersData.length;
            const totalTeams = teamsData.length;
            const avgPIV = playersData.reduce((sum, p) => sum + (p.piv || 0), 0) / totalPlayers;
            const avgTIR = teamsData.reduce((sum, t) => sum + (t.tir || 0), 0) / totalTeams;

            document.getElementById('stats-overview').innerHTML = `
                <div class="card">
                    <div class="stat">
                        <div class="stat-icon" style="background: #2563eb;">P</div>
                        <div>
                            <div class="stat-label">Total Players</div>
                            <div class="stat-value">${totalPlayers}</div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="stat">
                        <div class="stat-icon" style="background: #059669;">T</div>
                        <div>
                            <div class="stat-label">Total Teams</div>
                            <div class="stat-value">${totalTeams}</div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="stat">
                        <div class="stat-icon" style="background: #dc2626;">PIV</div>
                        <div>
                            <div class="stat-label">Avg PIV</div>
                            <div class="stat-value">${avgPIV.toFixed(3)}</div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="stat">
                        <div class="stat-icon" style="background: #7c3aed;">TIR</div>
                        <div>
                            <div class="stat-label">Avg TIR</div>
                            <div class="stat-value">${avgTIR.toFixed(3)}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function displayTopPlayers() {
            const topPlayers = playersData.sort((a, b) => (b.piv || 0) - (a.piv || 0)).slice(0, 10);
            const html = topPlayers.map(player => `
                <div class="player-item">
                    <div>
                        <div class="player-name">${player.name}</div>
                        <div class="player-team">${player.team}</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="piv-score">${(player.piv || 0).toFixed(3)}</div>
                        <div class="role-badge">${player.role || 'Unknown'}</div>
                    </div>
                </div>
            `).join('');
            document.getElementById('top-players-dashboard').innerHTML = html;
        }

        function displayTopTeams() {
            const topTeams = teamsData.sort((a, b) => (b.tir || 0) - (a.tir || 0)).slice(0, 8);
            const html = topTeams.map(team => `
                <div class="player-item">
                    <div>
                        <div class="player-name">${team.name}</div>
                        <div class="player-team">${team.players?.length || 0} players</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="piv-score">${(team.tir || 0).toFixed(3)}</div>
                        <div class="role-badge">TIR</div>
                    </div>
                </div>
            `).join('');
            document.getElementById('top-teams-dashboard').innerHTML = html;
        }

        function populateFilters() {
            const teams = [...new Set(playersData.map(p => p.team))].sort();
            const teamSelect = document.getElementById('team-filter');
            teamSelect.innerHTML = '<option value="">All Teams</option>' + 
                teams.map(team => `<option value="${team}">${team}</option>`).join('');

            const player1Select = document.getElementById('player1-select');
            const player2Select = document.getElementById('player2-select');
            const teamASelect = document.getElementById('teamA-select');
            const teamBSelect = document.getElementById('teamB-select');

            if (player1Select) {
                const playerOptions = playersData.map(p => `<option value="${p.name}">${p.name} (${p.team})</option>`).join('');
                player1Select.innerHTML = '<option value="">Select Player 1</option>' + playerOptions;
                player2Select.innerHTML = '<option value="">Select Player 2</option>' + playerOptions;
            }

            if (teamASelect) {
                const teamOptions = teamsData.map(t => `<option value="${t.name}">${t.name}</option>`).join('');
                teamASelect.innerHTML = '<option value="">Select Team A</option>' + teamOptions;
                teamBSelect.innerHTML = '<option value="">Select Team B</option>' + teamOptions;
            }
        }

        function filterAndDisplayPlayers() {
            const teamFilter = document.getElementById('team-filter').value;
            const roleFilter = document.getElementById('role-filter').value;
            const sortFilter = document.getElementById('sort-filter').value;

            let filtered = playersData.filter(player => {
                return (!teamFilter || player.team === teamFilter) &&
                       (!roleFilter || player.role === roleFilter);
            });

            filtered.sort((a, b) => {
                if (sortFilter === 'name') return a.name.localeCompare(b.name);
                if (sortFilter === 'kd') return (b.kd || 0) - (a.kd || 0);
                return (b.piv || 0) - (a.piv || 0);
            });

            displayPlayersGrid(filtered);
        }

        function displayPlayersGrid(players) {
            const html = players.map(player => `
                <div class="card">
                    <h3>${player.name}</h3>
                    <div style="margin-bottom: 16px;">
                        <div style="color: #94a3b8;">${player.team} - ${player.role || 'Unknown'}</div>
                        <div style="font-size: 24px; font-weight: bold; color: #3b82f6; margin: 8px 0;">${(player.piv||0).toFixed(3)} PIV</div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>K/D Ratio</span>
                            <span style="font-weight: 600;">${(player.kd||0).toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>Maps Played</span>
                            <span style="font-weight: 600;">${player.maps || 0}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Rating</span>
                            <span style="font-weight: 600;">${(player.rating||0).toFixed(2)}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            document.getElementById('players-grid').innerHTML = html;
        }

        function displayTeamsGrid() {
            const html = teamsData.map(team => `
                <div class="card">
                    <h3>${team.name}</h3>
                    <div style="margin-bottom: 16px;">
                        <div style="color: #94a3b8;">${team.players?.length || 0} players</div>
                        <div style="font-size: 24px; font-weight: bold; color: #059669; margin: 8px 0;">${(team.tir||0).toFixed(3)} TIR</div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>Avg PIV</span>
                            <span style="font-weight: 600;">${(team.averagePIV||0).toFixed(3)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>Total Rounds</span>
                            <span style="font-weight: 600;">${team.totalRounds || 0}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Win Rate</span>
                            <span style="font-weight: 600;">${((team.roundsWon || 0) / Math.max(team.totalRounds || 1, 1) * 100).toFixed(1)}%</span>
                        </div>
                    </div>
                </div>
            `).join('');
            document.getElementById('teams-grid').innerHTML = html;
        }

        function displayAnalyticsView() {
            const topPIV = Math.max(...playersData.map(p => p.piv || 0));
            const topTIR = Math.max(...teamsData.map(t => t.tir || 0));
            const avgKD = playersData.reduce((sum, p) => sum + (p.kd || 0), 0) / playersData.length;
            
            document.getElementById('insights-panel').innerHTML = `
                <div style="margin-bottom: 12px; padding: 12px; background: #1e293b; border-radius: 6px;">
                    <strong>Top PIV Score:</strong> ${topPIV.toFixed(3)}
                </div>
                <div style="margin-bottom: 12px; padding: 12px; background: #1e293b; border-radius: 6px;">
                    <strong>Highest TIR:</strong> ${topTIR.toFixed(3)}
                </div>
                <div style="margin-bottom: 12px; padding: 12px; background: #1e293b; border-radius: 6px;">
                    <strong>Average K/D:</strong> ${avgKD.toFixed(2)}
                </div>
                <div style="padding: 12px; background: #1e293b; border-radius: 6px;">
                    <strong>Tournament:</strong> IEM Katowice 2025
                </div>
            `;

            const roles = {};
            playersData.forEach(player => {
                const role = player.role || 'Unknown';
                if (!roles[role]) {
                    roles[role] = { count: 0, totalPIV: 0 };
                }
                roles[role].count++;
                roles[role].totalPIV += (player.piv || 0);
            });

            Object.keys(roles).forEach(role => {
                roles[role].avgPIV = roles[role].totalPIV / roles[role].count;
            });

            document.getElementById('advanced-metrics').innerHTML = `
                <div style="margin-bottom: 12px;"><h4>Role Distribution</h4></div>
                ${Object.entries(roles).map(([role, stats]) => `
                    <div style="display: flex; justify-content: space-between; padding: 8px; background: #1e293b; border-radius: 4px; margin-bottom: 8px;">
                        <span>${role}</span>
                        <span>${stats.count} (${stats.avgPIV.toFixed(3)} avg)</span>
                    </div>
                `).join('')}
            `;

            const topPerformers = [...playersData].sort((a, b) => (b.piv || 0) - (a.piv || 0)).slice(0, 3);
            document.getElementById('outliers-analysis').innerHTML = `
                <div style="margin-bottom: 12px;"><h4>Top Performers</h4></div>
                ${topPerformers.map(player => `
                    <div style="padding: 8px; background: #1e293b; border-radius: 4px; margin-bottom: 8px;">
                        <div style="font-weight: 600;">${player.name}</div>
                        <div style="font-size: 12px; color: #94a3b8;">${player.team} - ${(player.piv || 0).toFixed(3)} PIV</div>
                    </div>
                `).join('')}
            `;
        }

        function comparePlayers() {
            const player1Name = document.getElementById('player1-select').value;
            const player2Name = document.getElementById('player2-select').value;
            
            if (!player1Name || !player2Name) {
                alert('Please select both players for comparison');
                return;
            }

            const player1 = playersData.find(p => p.name === player1Name);
            const player2 = playersData.find(p => p.name === player2Name);

            document.getElementById('comparison-results').innerHTML = `
                <div class="card">
                    <h3>${player1.name}</h3>
                    <div style="margin-bottom: 16px;">
                        <div style="color: #94a3b8;">${player1.team} - ${player1.role}</div>
                        <div style="font-size: 24px; font-weight: bold; color: #3b82f6; margin: 8px 0;">${(player1.piv||0).toFixed(3)} PIV</div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>K/D Ratio</span>
                            <span style="font-weight: 600;">${(player1.kd||0).toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>Role</span>
                            <span style="font-weight: 600;">${player1.role}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Team</span>
                            <span style="font-weight: 600;">${player1.team}</span>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h3>${player2.name}</h3>
                    <div style="margin-bottom: 16px;">
                        <div style="color: #94a3b8;">${player2.team} - ${player2.role}</div>
                        <div style="font-size: 24px; font-weight: bold; color: #3b82f6; margin: 8px 0;">${(player2.piv||0).toFixed(3)} PIV</div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>K/D Ratio</span>
                            <span style="font-weight: 600;">${(player2.kd||0).toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>Role</span>
                            <span style="font-weight: 600;">${player2.role}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Team</span>
                            <span style="font-weight: 600;">${player2.team}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function predictMatch() {
            const teamAName = document.getElementById('teamA-select').value;
            const teamBName = document.getElementById('teamB-select').value;
            
            if (!teamAName || !teamBName) {
                alert('Please select both teams for prediction');
                return;
            }

            const teamA = teamsData.find(t => t.name === teamAName);
            const teamB = teamsData.find(t => t.name === teamBName);

            const teamAStrength = (teamA.tir || 0) + Math.random() * 0.1;
            const teamBStrength = (teamB.tir || 0) + Math.random() * 0.1;
            const total = teamAStrength + teamBStrength;
            const teamAWinProb = (teamAStrength / total * 100);
            const teamBWinProb = (teamBStrength / total * 100);

            document.getElementById('prediction-results').innerHTML = `
                <div class="grid grid-2" style="margin-top: 20px;">
                    <div class="card">
                        <h3>${teamA.name}</h3>
                        <div style="font-size: 32px; font-weight: bold; color: #059669; text-align: center; margin: 16px 0;">
                            ${teamAWinProb.toFixed(1)}%
                        </div>
                        <div style="text-align: center; color: #94a3b8;">Win Probability</div>
                        <div style="margin-top: 16px;">
                            <div>TIR Score: <strong>${(teamA.tir||0).toFixed(3)}</strong></div>
                            <div>Avg PIV: <strong>${(teamA.averagePIV||0).toFixed(3)}</strong></div>
                            <div>Players: <strong>${teamA.players?.length || 0}</strong></div>
                        </div>
                    </div>
                    <div class="card">
                        <h3>${teamB.name}</h3>
                        <div style="font-size: 32px; font-weight: bold; color: #dc2626; text-align: center; margin: 16px 0;">
                            ${teamBWinProb.toFixed(1)}%
                        </div>
                        <div style="text-align: center; color: #94a3b8;">Win Probability</div>
                        <div style="margin-top: 16px;">
                            <div>TIR Score: <strong>${(teamB.tir||0).toFixed(3)}</strong></div>
                            <div>Avg PIV: <strong>${(teamB.averagePIV||0).toFixed(3)}</strong></div>
                            <div>Players: <strong>${teamB.players?.length || 0}</strong></div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Event listeners
        document.getElementById('team-filter').addEventListener('change', filterAndDisplayPlayers);
        document.getElementById('role-filter').addEventListener('change', filterAndDisplayPlayers);
        document.getElementById('sort-filter').addEventListener('change', filterAndDisplayPlayers);

        // Load data and initialize
        Promise.all([
            fetch('/api/players').then(r => r.json()),
            fetch('/api/teams').then(r => r.json())
        ]).then(([players, teams]) => {
            playersData = players;
            teamsData = teams;
            
            document.getElementById('loading').style.display = 'none';
            populateDashboard();
            showView('dashboard');
        }).catch(error => {
            console.error('Error loading data:', error);
            document.getElementById('loading').innerHTML = '<div style="color: #dc2626;">Failed to load advanced analytics. Please refresh the page.</div>';
        });
    </script>
</body>
</html>